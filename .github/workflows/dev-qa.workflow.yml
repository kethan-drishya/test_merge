# @format

name: Deploy on qa Env ðŸš€
on:
  push:
    branches: ["dev-qa"]
jobs:
  run:
    runs-on: [ubuntu-latest]
    # container: docker://dvcorg/cml-py3:latest
    env:
          repo_token: ${{ secrets.REPO_TOKEN }}
          repo_name: ${{ github.event.repository.name }}
    steps:
      - uses: actions/checkout@v2
      - name: Merging dev-qa into dev-qa2       
        run: |
          git config --global user.email "kethan.sarma@drishya.ai"
          git config --global user.name "Kethan Sarma"
          git clone "https://$GITHUB_ACTOR:$repo_token@github.com/kethan-drishya/$repo_name.git"
          cd $repo_name
          git remote add upstream https://github.com/kethan-drishya/$repo_name.git
          git config --local merge.ours.driver true
          git checkout dev-qa2
          git fetch --all          
          git merge upstream/dev-qa
          git push
      - name: Cleanup
        run: |
          cd ..
          sudo rm -r -f $repo_name



  
